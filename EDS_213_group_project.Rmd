---
title: "EDS 213 Group Project"
author: "Halina Do-Linh, Marie Rivers, Allie Cole"
date: "10/8/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(httr)
library(dataRetrieval)
library(metajam)
library(lubridate)
```

## Assignment 2.3 - Use an API to retrieve data

- We need to document metadata? 

```{r }
# Santa Barbara Coastal LTER, Daniel C Reed, Shannon Harrer, Clint J Nelson, and Robert J Miller. 2021. SBC LTER: Reef: Sightings of sea otters (Enhydra lutris) near Santa Barbara and Channel Islands, ongoing since 2007.
data_lter_url <- "https://cn.dataone.org/cn/v2/resolve/https%3A%2F%2Fpasta.lternet.edu%2Fpackage%2Fdata%2Feml%2Fknb-lter-sbc%2F61%2F8%2F85e13b27599bf1ed68c7930674e1e7bd"

metajam::download_d1_data(data_lter_url, "data", "counts_sb")
```

```{r}
#Santa Barbara Coastal LTER, Steven C Schroeter, John Douglas Dixon, Thomas Ebert, and John Richards. 2021. SBC LTER: Settlement of urchins and other invertebrates, ongoing since 1990. LTER Network Member

data_urchins_url <- "https://cn.dataone.org/cn/v2/resolve/https%3A%2F%2Fpasta.lternet.edu%2Fpackage%2Fdata%2Feml%2Fknb-lter-sbc%2F52%2F10%2F6f1d97294f041ee3d39cda102e0223af"

metajam::download_d1_data(data_urchins_url, "data", "urchins")
```


```{r}
otter_LTER <- read_csv("data/counts_sb/Sea_Otter_Abundance_20210803.csv") %>%
  filter(YEAR <= 2011) %>%
  mutate(SITE = SBC_SITE) %>%
  mutate(SPECIES = "sea otter") %>%
  select(DATE, SITE, SPECIES, COUNT)

ggplot(data = otter_LTER, aes(x = DATE, y = COUNT)) +
  geom_point()
```


```{r}
urchins <- read_csv("https://cn.dataone.org/cn/v2/resolve/https%3A%2F%2Fpasta.lternet.edu%2Fpackage%2Fdata%2Feml%2Fknb-lter-sbc%2F52%2F10%2F6f1d97294f041ee3d39cda102e0223af", na = "-99999") %>%
  mutate(DATE = lubridate::mdy(DATE_RETRIEVED)) %>%
  filter(DATE >= "2007-01-01") %>%
  mutate(SPECIES = "urchin") %>%
  mutate(COUNT = TOTAL_URCHINS) %>%
  select(DATE, SITE, SPECIES, COUNT)
 
urchins
ggplot(data = urchins, aes(x = DATE, y = COUNT)) +
  geom_point()
```

```{r}
combined_data <- rbind(otter_LTER, urchins)
```


